<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>Kibana 3{{dashboard.current.title ? " - "+dashboard.current.title : ""}}</title>
    <link rel="stylesheet" href="css/bootstrap.light.min.css" title="Light">
    <link rel="stylesheet" href="css/timepicker.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/normalize.min.css">
    <!-- load the root require context -->
    <script src="vendor/require/require.js"></script>
    <script src="app/components/require.config.js"></script>
	<script src="infinit.e.js"></script>
	<script src="jquery.js"></script>
    <script>
		require(['app'], function (app) {
			app.config(function($httpProvider){
				   $httpProvider.interceptors.push('myHttpInterceptor');
						   $httpProvider.defaults.withCredentials = true;
			})
			.factory('myHttpInterceptor', function($q, $window){
			   return {
						request: function(config){
						//console.log('Request interception'); // LOG AT REQUEST START

						try{
							var cids = infiniteJsConnector.getExtraUrlParams();
							//console.log('cids received: ' + cids);
							if(cids != 'error'){
								config.url += cids;
							}

						}catch(error){
							/*fail here could happen if infiniteJsConnector is not ready yet*/
						}
						return config || $q.when(config);
					   }
			   };
			});


		});
		
		infiniteJsConnector.onNewDocumentSet = function(alreadyHaveAssocs) {
					var cids; 
					if (!alreadyHaveAssocs) {
						try {
							cids = infiniteJsConnector.getCommunityIds();
						}
						catch (e) {
							alert("error: " + e);
						}
					}
					else {
						cids = alreadyHaveAssocs;
					}
				};
		infiniteJsConnector.setLive = function(isLive){
				//console.log('setLive called');console.log(isLive);
				if(isLive==true){
					infiniteJsConnector._mode = 'live';
				}else if(isLive==false){
					infiniteJsConnector._mode = 'stashed';
				}
			};
		infiniteJsConnector.onWidgetLoadWithParameters = function(paramString){
			//var str = "?cids=1,2,3&mode=live";
			var str = paramString;
			var res = str.split("cids=");
			var cids= res[1].split("&");
			infiniteJsConnector.setCIds(cids[0]);
			
			var sec = str.split("mode=");
			var mode= sec[1].split("&");
			infiniteJsConnector.setMode(mode[0]);
			
		},
		$(window).load(function() {
			try {
				//console.log('window.location.search');
				//console.log(window.location.search);
				if(window.location.search.length > 0){
					infiniteJsConnector.onWidgetLoadWithParameters(window.location.search);
				}else{				
					//console.log('params are not present');
				}
				infiniteJsConnector.init();
				
			}
			catch (e) {
				console.log("infinite init error: " + e);
				console.log(e);
			}
		});
        
        
		
</script>
    <style>
    </style>

  </head>

  <body>
    <noscript>
      <div class="container">
        <center><h3>You must enable javascript to use Kibana</h3></center>
      </div>
    </noscript>
    <!--<link rel="stylesheet" ng-href="css/bootstrap.{{dashboard.current.style||'dark'}}.min.css">-->
    <link rel="stylesheet" ng-href="css/bootstrap.{{dashboard.current.style||'dark'}}.min.css">
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <div ng-cloak ng-repeat='alert in dashAlerts.list' class="alert-{{alert.severity}} dashboard-notice" ng-show="$last">
      <button type="button" class="close" ng-click="dashAlerts.clear(alert)" style="padding-right:50px">&times;</button>
      <strong>{{alert.title}}</strong> <span ng-bind-html='alert.text'></span> <div style="padding-right:10px" class='pull-right small'> {{$index + 1}} alert(s) </div>
    </div>
    <div ng-cloak class="navbar navbar-static-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <span class="brand"><img src="img/small.png" bs-tooltip="'Kibana '+(kbnVersion=='@REV@'?'master':kbnVersion)" data-placement="bottom"> {{dashboard.current.title}}</span>

          <ul class="nav pull-right" ng-controller='dashLoader' ng-init="init()" ng-include="'app/partials/dashLoader.html'">
          </ul>
        </div>
      </div>
    </div>

    <div ng-cloak ng-view></div>

  </body>
</html>